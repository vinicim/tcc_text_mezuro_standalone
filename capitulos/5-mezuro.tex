\chapter{Mezuro: Uma plataforma de Monitoramento de Código Fonte}

%Introdução
A prática da engenharia de software exige compreensão do sistema desenvolvido como um todo, onde o código-fonte é uma das partes mais importantes. O engenheiro de software precisa analizar um código-fonte diversas vezes, seja para desenvolver novas funcionalidades ou melhorar as existentes \cite{meirelles2010mezuro}.

Como parte fundamental do projeto de software, o código-fonte é um dos principais artefatos para avaliar sua qualidade \cite{meirelles2009crab}. Essas avaliações não são meramente subjetivas, sendo necessário extrair informações que possam ser replicadas e entendidas da mesma forma, independente de quem analisa o código. As métricas de código-fonte permitem esse tipo de avaliação pois possibilitam analisar, de forma objetiva, as principais características para aceitação de um software.

%Métricas código-fonte
Há várias características que fazem do software um sistema de qualidade ou não. Entre elas há algumas que são obtidas exclusivamente através do código-fonte. Quando compilamos um software, por exemplo, características podem ser analisadas, mas outras como organização e legibilidade não. Isso não refletiria tamanho, modularidade, manutenbilidade, complexidade, flexibilidade, que são características encontradas na análise de códigos-fonte \cite{meirelles2013metrics}.

%Ferramentas para monitoramento de métricas de código-fonte
O esforço necessário para extrair métricas de código-fonte manualmente pode ser considerado imensurável. Quanto maior e mais complexo é o código, esse tipo de atividade se torna ainda mais distante das equipes de desenvolviento, dada a quantidade de propriedades e linhas de códigos a se analisar, além de não ser viável pelo tempo despendido. Para essas atividades existem ferramentas CASE\footnote{Computer Aided Software Engineering - Classificação que abrange todas as ferramentas que auxiliam atividades de engenharia de software } que auxiliam nessas atividades. Por meio da extração e monitoramento automático de métricas de código-fonte, essas ferramentas auxiliam  a equipe durante o processo de desenvolvimento. Porém, existem existem poucas ferramentas disponíveis no mercado, e muitas delas nem sempre são adequadas para análise do projeto alvo (software-livre) \cite{meirelles2010mezuro}.
%Métricas são fundamentais para a melhora contínua de um projeto de software livre
Como parte fundamental do projeto de software,
%Mezuro
  %Histórico Ferramentas até chegar ao Mezuro [tese prof. Paulo] 
    %Contexto das ferramentas
A partir da necessidade de extrair métricas de código-fonte e interpretar seus valores, foi desenvolvida uma plataforma chamada Mezuro. Ela possibilita o monitoramento de características específicas do software \footnote{\url{http://mezuro.org/}}. Porém, essa ferramenta não foi criada da noite para o dia. O Mezuro foi concebido através de um longo processo de amadurecimento de diversas ferramentas, que teve seu início com o projeto Qualipso\footnote{\url{http://qualipso.icmc.usp.br/}}.

    %Ferramentas similares
No contexto do trabalho desenvolvido com o Mezuro, foram encontrados alguns projetos\footnote{flossmetrics.org,ohloh.net,qualoss.org,sqo-oss.org,qsos.org,fossology.org,code.google.com/p/hackystat,codeclimate.com} com propósitos similares\cite{meirelles2010mezuro}, entre eles:

\begin{itemize}
\item \textbf{FlossMetrics} (Free/Libre Open Source Software Metrics) é um projeto que utiliza metodologias e ferramentas existentes para fornecer  uma extensa base de dados com informações sobre desenvolvimento de software livre;
\item \textbf{Ohloh} é um website que fornece um conjunto de web services e uma plataforma online com o objetivo de construir uma visão geral sobre o desenvolvimento de software livre;
\item \textbf{Qualoss} (Quality in Open Source Software) é  uma metodologia para automatizar a medição de qualidade de projetos de software livre, utilizando ferramentas para analisar o código-fonte e informações sobre seu repositório;
\item \textbf{SQO-OSS} (Software Quality Assessment of Open Source Software) fornece um conjulnto de ferramentas de análise e benchmarking de projetos de software livre.
\item \textbf{QSOS} (Qualification and Selection of Open Source Software) é uma metodologia baseada em quatro passos: definição de referência utilizada, avaliação do software, qualificação de usuários específicos, e por último, seleção e comparação de software;
\item \textbf{FOSSology} (Advancing Open Source Analysis and Development) é um projeto que fornece uma base de dados aberta com informações sobre licensas de software;
\item \textbf{HackyStat} é um ambiente de análise, visualização e interpretação de processos de desenvolvimento e dados de software.
\item \textbf{CodeClimate} é um software que auxilia a inserção de qualidade em códigos-fonte escritos na linguagem Ruby por meio da analise de quatro indícios (smells): 
	\begin{itemize}
	\item \textbf{Duplicação} - Estruturas sintáticas repetidas ou similares no projeto.
	\item \textbf{Método complexo} - Alta complexidade para a definição de um método.
	\item \textbf{Classe complexa} - Quando há classes muito grandes no projeto, o que pode ser um sinal de baixa coesão\footnote{Representa o grau de especialização de uma classe para desempenhar papeis em um contexto. Quanto menos responsabilidades tiver uma classe, mais coesa ela será.}.
	\item \textbf{Alta complexidade total em classes} - Mesmo que os métodos da classe sejam simples, se a classe for muito grande é sinal que ela possibilitando o monitoramento de características específicas do software tem muitas responsabilidades.
	\end{itemize}
\end{itemize}
    
Em particular, o projeto Mezuro surgiu antes do CodeClimate, que provê serviços similares aos pretendidos pelo Mezuro, mas monitorando 3 métricas para códigos Ruby.

\section{Concepção do Projeto Mezuro}

	%Projeto Qualipso
O projeto (Qualipso Quality Platform for Open Source) é hoje um consórcio formado por indústria, academia, e governo. Seu principal objetivo é potencializar as práticas de desenvolvimento de software livre, tornando-as confiáveis, reconhecidas e estabelecidas na indústria, através da implementação de tecnologias, procedimentos e leis \cite{qualipso2009}. 
	
	%Jabuti, ponto de partida
Uma das iniciativas desse projeto envolvia  a adaptaçao da ferramenta JaBUTi - Java Bytecode Understanding and Testing, uma ferramenta de análise de softwares em linguagem Java. O objetivo inicial era melhorar o módulo de cálculo das métricas fornecido pela JaBUTi. Porém a proposta foi alterada para a visualização de métricas, com configuração de intervalos das mesmas, facilitando a análise dos resultados. Esse módulo de visualização, posteriormente, se transformou em uma aplicação independente, o Crab \cite{meirelles2009crab}. Neste instante o JaBUTi calculava as métricas e posteriormente chamava o Crab para a visualização e configuração das mesmas,  assim como criação de novas métricas compostas. Após a experiência com a JaBUTi como ferramenta base, ou seja, aquela que coleta métricas de código-fonte, buscou-se outras alternativas para essa tarefa já que a JaBUTi era restrita a códigos escritos  em liguagem Java, o que limita a contribuição com softwares livre.

	%Analizo
Uma alternativa encontrada foi o software livre denominado Analizo\footnote{\url{http://analizo.org/}}, que surgiu a partir de um outro software livre denominado Egypt\footnote{\url{http://gson.org/egypt/}}. O resultado após diversas contribuições (principalemnte de Antônio Terceiro e do grupo CCSL-USP) foram diversas funcionalidades que fugiram do escopo inicial do Egypt, o qual foi renomeado como Analizo ("análise" em esperanto). %descrever melhor o analizo

Na integração do Analizo com a Crab, este último consome serviços do Analizo, ao contrário do que acontecia na integração da JaBUTi com a Crab, onde a ferramenta base aciona o módulo de visualização (Crab) após a coleta das métricas. Essa inversão de paradigma e outras mudanças de impacto fez com que a Crab fosse relicenciada como LGPL versão 3, e para padronizar o nome das ferramentas a Crab passou a se chamar Kalibro ("calibrar" em esperanto). Em sua primeira versão para o projeto Qualipso o Kalibro possuia base de dados própria, calculava estatísticas para as métricas coletadas e exibia os resultados baseando-se nas configurações cadastradas. 

Após a primeira versão do Kalibro integrada ao Analizo, decidiu-se separar a coleta, configuração e interpretação de métricas da sua visualização. Com isso surgiu o Kalibro Service, um serviço web sem interface gráfica, o qual possui todas as funcionalidades não-visuais que hoje são fornecidas pela plataforma Mezuro \cite{meirelles2013metrics}.

%Kalibro
%Consumo dos serviços do Kalibro - webService (http://www.teses.usp.br/teses/disponiveis/45/45134/tde-25092013-142158/)
%----------------------------------------------------------------------------%

\section{Mezuro como Plugin do Noosfero}

%O que é o Noosfero
O Mezuro foi concebido como instância de uma plataforma web conhecida como Noosfero com o plugin Mezuro ativado. O Noosfero é um software livre para criação de redes sociais desenvolvido pela Cooperativa de Tecnologias Livres - Coolivre \footnote{\url{http://colivre.coop.br/}} sob licença AGPL v.3 com o intuito de permitir que os usuários criem sua própria rede social livre e personalizada de acordo com suas necessidades.

%Arquitetura do Noosfero
A linguagem de programação Ruby e o framework MVC Ruby on Rails foram utilizados para desenvolver o Noosfero. Essas tecnologias foram escolhidas pois a linguagem Ruby possui uma sintaxe simples, que facilita a manunbilidade do sistema, característica importante em projetos de software livre que tendem a atrair colaboradores externos a equipe. Já o framework Ruby on Rails influencia em maior produtividade graças a conceitos como \textit{convention over configuration} e DRY [baseado TCC Daniel].

%Arquitetura de plugins do Noosfero
A arquitetura do Noosfero permite a adição de novas funcionalidades através de plugins. Essa característica é interessante pois colaboradores podem implementar novas funcionalidades sem entender ou interagir com o código-fonte do Noosfero, já que os plugins possuem o código isolado, mantendo o baixo acoplamento e alta coesão dos módulos do sistema. Embora plugins sejam totalmente independentes do sistema alvo, no Noosfero os plugins são mantidos com o código principal para auxiliar no controle de qualidade do ambiente. Pensando nisso os plugins devem ter testes automatizados. Quando houver a necessidade de alterar o código do Noosfero, os testes dos plugins são executados para verificar se as mudanças não afetaram seu funcionamento \cite{noosfero2013plugins}.

\graphicspath{{figuras/}}
\begin{figure}[!htb]
\centering
\includegraphics{plugins}
\caption{Arquitetura de Plugins do Noosfero}
\label{Rotulo}
\end{figure}

%Implementação do Mezuro como plugin do Noosfero
%Funcionalidades atuais do Mezuro
O Mezuro como plugin do Noosfero foi construído utilizando o recurso de plugins do framework Ruby on Rails. Por esse motivo ele herda a arquitetura desse framework, a qual é baseada no padrão arquitetural MVC, assim como o Noosfero.
O Mezuro utiliza um web service chamado Kalibro Metrics. Isso permite ao Mezuro: 

\begin{itemize}
\item Baixar códigos-fonte de repositórios dos tipos GIT, Subversion, Baazar e CVS
\item Criação de configurações as quais são conjuntos pré-definidos de métricas relacionadas para serem utilizadas na avaliação de projetos de software.
\item Criação de intervalos relacionados com a métricas e avaliações qualitativas.
\item Criação de novas métricas compostas, de acordo com aquelas fornecidas pelos coletores do Kalibro.
\item Cálculo de resultados estatísticos para módulos com alta granularidade.
\item Possibilidade de exportar arquivos com os resultados gerados.
\item Interpretação dos resultados com inteface mais amigável aos usuarios com a utilização de cores nos intervalos das métricas.
\end{itemize}

%----------------------------------------------------------------------------%
\section{Mezuro como aplicação independente}

%Motivos para evolução

  %Evolução do framework rails: novos recursos para o desenvolvimento e gerenciamento das dependências, em especial da "gems" para visualização dos resultados. Além do suporte da comunidade Rails, que é global, para as últimas versões do Raisl e o Ruby. O que tem de novo no Rails 3 e 4 em relação ao Rails 2?

Acompanhando a evolução do framework Rails, a equipe de desenvolvimento da plataforma Mezuro decidiu atualiza-la para as novas versões oferecidas do Ruby on Rails e da linguagem Ruby, as quais possuem atualmente as versões 4 e 2, respectivamente. Um dos motivos para essa atualização é aproveitar os novos recursos oferecidos, além do suporte da comunidade\footnote{\url{http://rubyonrails.org/}}, que favorece a utilização das versões mais novas.

%Recursos desnecessários do Noosfero para o Mezuro: O Mezuro precisou se moldar mais ao Kalibro ao invés de se adaptar mais ao Noosfero como plugins (uma integração entre o Mezuro e o Noosfero continuará, mas como duas aplicações independentes). O Mezuro não precisa de todos os recursos de um rede social, como amigos e relacionamentos entre amigos, entre outras funcionalidades providas pelo Noosfero (blgo, fórum, upload de arquivos, CMS, chat, etc). Dessa forma, pensando no desempenho e na evolução do desenvolvimento do Mezuro, com o objetivo de formatar um comunidade de software livre para atrair desenvolvedores, resolveu-se retirar o Mezuro como um plugin do Noosfero, para não mais o limitar ao andamento do desenvolvimento do Noosfero. Em suma, o Mezuro ser um serviço na Web com foco apenas no monitoramento de código-fonte, podemos se integrar e complementar outros serviços disponíveis com o Olhoh /footnote{/url{http://ohloh.net}}. Em particular, o projeto Mezuro surgiu antes do CodeClimate /footnote{/url{http://codeclimate.com}}, que provê serviço similares aos pretendidos pelo Mezuro, mas monitorando 3 métricas para códigos Ruby.
Além disso, há outros fatores que influenciaram a evolução do Mezuro. Como já foi mencionado o Mezuro foi concebido como um plugin do Noosfero. O Noosfero, porém, possui muitos recursos desnecessários para uma ferramenta de monitoramento de código-fonte. Entre esses recursos estão: blog, fórum, upload de arquivos, CMS, chat entre outros. A manutenção do Mezuro como plugin se tornava cada vez mais complexa conforme ele evoluia, pois ao invés de fornecer um número baixo de funcionalidades, ou funcionalidades muito específicas, que é o princípio de um plugin, o Mezuro acabou se transformando em uma aplicação, a qual depende de outra aplicação, o Noosfero. 

Pensando no desempenho, manutenibilidade, e com o objetivo de formatar uma comunidade de software livre para atrair novos colaboradores, resolveu-se retirar o Mezuro como plugin do Noosfero e evolui-lo para um plataforma independente, o Mezuro Standalone.
  
%Nova arquitetura


